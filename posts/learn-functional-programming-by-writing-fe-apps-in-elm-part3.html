<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta property="og:site_name" content="KaFai Choi">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Learn functional programming by writing FE apps in Elm (pt.3)">
    <meta property="og:image" content>
    <meta property="og:url" content="https://bruteforcecat.github.io/posts/learn-functional-programming-by-writing-fe-apps-in-elm-part3.html">
    <meta property="og:description" content="Learn functional programming by writing FE apps in Elm (pt.3)">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="KaFai Choi">
    <meta name="description" content="Learn functional programming by writing FE apps in Elm (pt.3)">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="../css/default.css">
    <link rel="stylesheet" type="text/css" href="../css/pandoc.css">
    <link rel="alternate" type="application/rss+xml" href="../rss.xml" title="RSS">
    <script>try{Typekit.load({ async: true });}catch(e){}</script>
    <script type="text/javascript" src="https://cdn.rawgit.com/mathjax/MathJax/2.7.1/MathJax.js"></script>
    <title>Learn functional programming by writing FE apps in Elm (pt.3)</title>
  </head>
  <body>
    <nav class="navigation">
      <ul class="navigation__list">
        <li class="navigation__item">
          <a class="header__link" href="../">
            Y = λf.(λx.f(xx))(λx.f(xx))
          </a>
        </li>
      </ul>
    </nav>
    
    <article>
  <div class="article__infoContainer">
    <div class="article__info">
      <p class="article__title">
         Learn functional programming by writing FE apps in Elm (pt.3)
      </p>
      <time class="article__date">July 30, 2017</time>
    </div>
  </div>
  <div class="article__content">
    <h2 id="quizwizard-quiz-list">QuizWizard &amp; Quiz List</h2>
<p>In part 3, we will persist our quiz created in firebase and we will add navigation to the App. So you can send the link of the quiz to let other to do it. You can play around with it <a href="http://bruteforcecat.github.io/quiz-maker/">here</a>.</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="fu">git</span> clone git@github.com:bruteforcecat/quiz-maker.git
<span class="fu">git</span> checkout v0.0.3</code></pre></div>
<p><br /></p>
<h2 id="new-folder-structure">New Folder Structure</h2>
<pre class="elm"><code>-- new folder structure
-- |- elm
--     |- Main.elm
--     |- Model
--        |- Quiz.elm
--        |- Shared.elm
--     |- Model.elm
--     |- Page
--        |- DoQuiz
--           |- Model.elm
--           |- Update.elm
--           |- View.elm
--        |- Home
--           |- Mode.elm
--           |- Update.elm
--           |- View.elm
--        |- Port
--           |- Utils.elm
--        |- Port.elm
--     |- QuizWizard
--        |- Model.elm
--        |- Update.elm
--        |- View.elm
--     |- Route.elm
--     |- Update
--        |- Utils.elm
--     |- Update.elm
--     |- View.elm</code></pre>
<p>We have a new folder <code>Page</code> and file <code>Route.elm</code> which contain page-specific logic and navigation logic. And finally <code>Port.elm</code> contain the logic of talking to JS.</p>
<p><br /></p>
<h2 id="javascript-interop">Javascript Interop</h2>
<pre class="elm"><code>-- Port.elm
port addQuiz : DraftQuiz -&gt; Cmd msg


port alert : String -&gt; Cmd msg


port addQuizResult : (ServerResult QuizFromServer -&gt; msg) -&gt; Sub msg
</code></pre>
<p>In Elm, we can use keyword <code>port</code> to talk to Javascript in runtime. In our quiz-maker apps, we need to call the function provide in firebase JS sdk to persist quiz and retrieve quizzes.</p>
<p>Just like doing other impure actions, we use <code>Command</code> to sending out value to JS. And in our javascript world, we will need to apply subscribe function on the port we are interested in.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="va">app</span>.<span class="va">ports</span>.<span class="va">addQuiz</span>.<span class="at">subscribe</span>(<span class="at">addQuiz</span>(<span class="va">app</span>.<span class="va">ports</span>.<span class="va">addQuizResult</span>.<span class="at">send</span>))<span class="op">;</span>
<span class="va">app</span>.<span class="va">ports</span>.<span class="va">alert</span>.<span class="at">subscribe</span>(msg <span class="op">=&gt;</span> <span class="va">window</span>.<span class="at">alert</span>(msg))<span class="op">;</span></code></pre></div>
<p>To send value back to Elm world, we will need to call <code>send</code> function with the value and we will need to apply the sub port in our subscription.</p>
<pre class="elm"><code>-- Update.elm
subscriptions : Model -&gt; Sub Msg
subscriptions model =
    Sub.batch
        [ Port.addQuizResult (Port.Utils.mapServerResult &gt;&gt; AddQuizResult)
        ]</code></pre>
<p>In Elm, we will use subscription to listen for some external events like web-socket, values send from JS. We have to define what <code>Msg</code> we want the runtime to apply them to the update function.</p>
<p><br /></p>
<h2 id="navigation">Navigation</h2>
<p>We will use <a href="https://github.com/elm-lang/navigation">elm-lang/navigation</a> and <a href="https://github.com/etaque/elm-route-parser">etaque/elm-route-parser</a> packages for that. <br /></p>
<p>For our main funciton, we will use <code>Navigation.programWithFlags</code>. The major difference is we need to provide one more argument <code>(Location -&gt; msg)</code> which is used by <code>Navigation</code> to convert the Location Record to a message.</p>
<pre class="elm"><code>-- Main.elm
main : Program Flags Model Msg
main =
    Navigation.programWithFlags
        (Route.parser &gt;&gt; Model.MountRoute)
        { init = Update.init
        , view = View.view
        , update = Update.update
        , subscriptions = Update.subscriptions
        }

-- Route.elm
parser : Navigation.Location -&gt; Route
parser location =
    fromPath location.hash

type Route
    = Home
    | DoQuiz String
    | NotFound

-- Update.elm
update : Msg -&gt; Model -&gt; ( Model, Cmd Msg )
update msg model =
    case msg of
        MountRoute route -&gt;
            mountRoute route model

-- Model.elm
type alias Model =
    { route : Route
    , quizzes : List Quiz
    , notification : Maybe String
    , doQuiz : DoQuizModel.Model
    , home : HomeModel.Model
    }

-- View.elm
view : Model -&gt; Html Msg
view ({ quizzes, route } as model) =
    let
        content =
            case route of
                Route.Home -&gt;
                    Html.map HomeMsg (PageHome.view quizzes model.home)

                Route.DoQuiz quizId -&gt;
                    Html.map DoQuizMsg (PageDoQuiz.view model.doQuiz)

                Route.NotFound -&gt;
                    notFoundView
    in
        renderSite model content
</code></pre>
<p>In our case, we will apply the <code>parser</code> function in Route which basically get Route from Location and then we will return a <code>MountRoute</code> Msg.</p>
<p>So whenever <code>update</code> function get called with <code>MountRoute</code> message, we will update route value in our model. And our view function just call page view function based on the current route.</p>
<p>So this is a very short part in tutorial but I do recommend you to check out the source code.</p>
<p>In the part 4, we will see we add random shuffling for our answer instead of putting the correct answer in the first one. This will be interesting because random number is intuitively not pure but its not referential transparent. Lets talk about it in the next part.</p>
  </div>
  
  <hr>
  <div class="disqus__block">
  <div id="disqus_thread"></div>
  <script>
  (function() { // DON'T EDIT BELOW THIS LINE
  var d = document, s = d.createElement('script');
  s.src = 'https://swtpain.disqus.com/embed.js';
  s.setAttribute('data-timestamp', +new Date());
  (d.head || d.body).appendChild(s);
  })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>

  
</article>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-102897942-1', 'auto');
      ga('send', 'pageview');

    </script>
    <script id="dsq-count-scr" src="//swtpain.disqus.com/count.js" async></script>
</html>
